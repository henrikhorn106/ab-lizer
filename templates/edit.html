{% extends "base.html" %}
{% block page_title %}Edit Test{% endblock %}
{% block page_button %}
    <div class="button-container">
        <button form="edit-form" class="btn" type="submit">Update AB Test</button>
    </div>
{% endblock %}
{% block content %}

    <div class="card big">
        <form id="edit-form" method="post" action="">

            <div class="form-group">
                <label class="details-label" for="name">Test Name:</label>
                <input type="text" class="details-head" id="name" name="name" value="{{ test.name }}">
            </div>

            <div class="form-group">
                <label class="details-label" for="description">Description:</label>
                <textarea class="details-textarea" id="description" name="description"
                          rows="6">{{ test.description }}</textarea>
            </div>

            <div class="form-group">
                <label class="details-label" for="metric">Main Metric:</label>
                <input type="text" id="metric" name="metric" value="{{ test.metric }}">
            </div>

            {% if variants != [] %}
                <div class="column-grid-2">
                    {% for variant in variants %}
                        <div class="metrics-card">
                            <input type="hidden" name="variant_id[]" value="{{ variant.id }}">
                            <h4>{{ variant.name }}</h4>
                            <div class="details-form-group">
                                <label class="details-label" for="sessions_{{ loop.index }}">Total Sessions:</label>
                                <input class="details-input right" type="text" id="sessions_{{ loop.index }}"
                                       name="sessions[]"
                                       value="{{ variant.impressions }}">
                            </div>
                            <div class="details-form-group">
                                <label class="details-label" for="conversions_{{ loop.index }}">Conversions:</label>
                                <input class="details-input right" type="text" id="conversions_{{ loop.index }}"
                                       name="conversions[]" value="{{ variant.conversions }}">
                            </div>
                        </div>
                    {% endfor %}
                </div>

            {% else %}
                <button class="btn" id="addVariantBtn">Add Variants</button>
            {% endif %}
        </form>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Updating Test & Generating AI Recommendation</div>
            <div class="loading-subtext">This may take a few moments...</div>
        </div>
    </div>

    {% block scripts %}
        <script src="{{ url_for('static', filename='edit_form.js') }}"></script>
    {% endblock %}

{% endblock %}
